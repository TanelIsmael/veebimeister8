"use strict";var _createClass=function(){function r(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,s){return e&&r(t.prototype,e),s&&r(t,s),t}}(),_get=function t(e,s,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,s);if(void 0===i){var n=Object.getPrototypeOf(e);return null===n?void 0:t(n,s,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}!function(o,i){var e=function(t){function r(t,e){_classCallCheck(this,r);var s=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,e));return s.checkedAnswersList="",s}return _inherits(r,o.Quiz),_createClass(r,[{key:"isFullyAnswered",value:function(t){var e=t.attr("data-index");return parseInt(this.questions[e].totalCorrects)<=t.find(".wq-answer.chosen").length}},{key:"afterClickAnswer",value:function(t,e){"multiple"!==this.settings.question_layout&&"off"!==this.settings.end_answers||this.checkQuestion(e),_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"afterClickAnswer",this).call(this,t,e)}},{key:"checkQuestion",value:function(r){var i=this,t=r.attr("data-index"),n=this.questions[t];if(n){var a=0<r.find(".wq-answer.chosen").length;this.checkedAnswersList+="<div><p><strong>"+n.title+"</strong></p>",Object.keys(n.answers).forEach(function(t){var e=n.answers[t],s=r.find('.wq-answer[data-id="'+t+'"]');e.isCorrect&&parseInt(e.isCorrect)?s.addClass("wq_correctAnswer"):s.hasClass("chosen")&&(s.addClass("wq_incorrectAnswer"),a=!1),s.hasClass("chosen")&&(i.checkedAnswersList+='<p class="'+(a?"is-correct":"is-incorrect")+'">'+e.title+"</p>"),"on"===i.settings.end_answers&&"multiple"===i.settings.question_layout&&s.removeClass("wq_correctAnswer").removeClass("wq_incorrectAnswer")}),this.checkedAnswersList+="</div>",a?(this.totalCorrects++,r.addClass("is-correct")):r.addClass("is-incorrect"),("off"===this.settings.end_answers||"single"===this.settings.question_layout||r.find(".wq-trivia-question-explanation").length)&&r.find(".wq-trivia-question-explanation").fadeIn()}}},{key:"trackAnswer",value:function(t){var e=t.attr("data-index"),s=this.questions[e],r={answers:[]};t.find(".wq-answer.chosen").each(function(t,e){return r.answers.push(e.dataset.id)}),this.tracker[s.id]=r}},{key:"complete",value:function(){var t=this;"single"===this.settings.question_layout&&"on"===this.settings.end_answers&&this.$wrapper.find(".wq-question").each(function(){t.checkQuestion(i(this))}),_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"complete",this).call(this)}},{key:"findResultId",value:function(){var e=this,s=this.totalCorrects,r=!1;this.results.forEach(function(t){r||s>=t.min&&s<=t.max&&(r=!0,e.resultId=t.id,e.result=t)})}},{key:"showResult",value:function(){var t=this;if(this.result.redirect_url)setTimeout(function(){window.location.href=t.result.redirect_url},500);else{var e=this.totalCorrects,s=this.totalQuestions,r=this.$wrapper.find(".wq-results"),i=this.$wrapper.find('.wq-result[data-id="'+this.resultId+'"]'),n=o.i18n.resultScore.replace("%%score%%",e).replace("%%total%%",s),a=this.$wrapper.find('.wq-question[data-index="'+this.lastQuestionIndex+'"]');i.find(".wq-result-score").text(n),i.find(".wq-checked-answers-list").html(this.checkedAnswersList),i.show(),"multiple"===this.settings.question_layout&&a.is(":visible")?a.animateCss(this.settings.animation_out,function(){a.hide();a.offset().top;a.hide(),r.show().animateCss(t.settings.animation_in)}):("on"===this.settings.end_answers&&this.scrollToQuestion(0),r.show())}}},{key:"savePlayData",value:function(){var e=this,t=o.restUrl+"wp-quiz/v2/play_data",s=o.helpers.getRequest({url:t,method:"POST",data:{quiz_id:this.quizId,quiz_data:this.quizData,answered:this.tracker,corrects:this.totalCorrects,result_id:this.resultId}});s.done(function(t){"number"==typeof t&&(e.$wrapper.find(".wq-subscribe-form").attr("data-tracking-id",t),e.$wrapper.find(".wq-share button").attr("data-tracking-id",t),i(".mfp-wrap .wq-popup .wq-share button").attr("data-tracking-id",t),e.$wrapper.find(".wq_forceShareFB").attr("data-tracking-id",t))}),s.fail(function(t){console.error(t)})}},{key:"restartQuiz",value:function(){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"restartQuiz",this).call(this),this.$wrapper.find(".wq_correctExplanationHead").removeClass("wq_correctExplanationHead"),this.$wrapper.find(".wq_wrongExplanationHead").removeClass("wq_wrongExplanationHead"),this.$wrapper.find(".wq_incorrectAnswer").removeClass("wq_incorrectAnswer"),this.$wrapper.find(".wq_correctAnswer").removeClass("wq_correctAnswer"),this.checkedAnswersList="",this.$wrapper.find(".wq-checked-answers-list").html("")}}]),r}();i(document).ready(function(){i(".wq-quiz-trivia").each(function(){var t=i(this).attr("data-quiz-id");void 0!==window["triviaQuiz"+t]&&new e(i(this),window["triviaQuiz"+t])})})}(wpQuiz,jQuery);