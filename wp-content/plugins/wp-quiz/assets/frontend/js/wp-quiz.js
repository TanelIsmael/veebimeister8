"use strict";var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(t,r){t.helpers=t.helpers||{},void 0===Object.values&&(Object.values=function(t){return Object.keys(t).map(function(e){return t[e]})}),t.helpers.loadEmbed=function(i,s){if(!i.hasClass("active")){var e={post_ID:0,type:"embed",shortcode:"[embed]"+s.url+"[/embed]",maxwidth:1e3},t=wp.ajax.post("parse-embed",e);t.done(function(e){var t=r(e.body);if(t.attr("width","100%"),t.attr("height","100%"),s.placeholder){var n=t.attr("src");t.attr("src",0<=n.indexOf("?")?n+"&autoplay=1":n+"?autoplay=1")}t.wrap('<div class="wq-embed-content"></div>').appendTo(i),i.addClass("active")}),t.fail(function(e){console.error(e.message)})}},t.helpers.getRequest=function(e){return e.beforeSend||(e.beforeSend=function(e){e.setRequestHeader("X-WP-Nonce",t.restNonce)}),r.ajax(e)},t.helpers.showLoading=function(e){var t=r(e);t.find(".wq-loading").length||(t.css("position","relative"),t.append('<div class="wq-loading"><span class="wq-icon wq-icon-spinner animate-spin wq-spinner"></span></div>')),t.addClass("wq-is-loading")},t.helpers.hideLoading=function(e){r(e).removeClass("wq-is-loading")},r.fn.extend({animateCss:function(e,t){var n=function(e){var t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var n in t)if(void 0!==e.style[n])return t[n]}(document.createElement("div"));return this.addClass("animated "+e).one(n,function(){r(this).removeClass("animated "+e),"function"==typeof t&&t()}),this}}),t.Quiz=function(){function n(e,t){_classCallCheck(this,n),(this.$wrapper=e).data("wpQuiz",this),this.quizData=t,this.quizId=t.id,this.questions=t.questions?Object.values(t.questions):[],this.results=t.results?Object.values(t.results):[],this.settings=t.settings||{},this.shareUrl=t.shareUrl,this.currentQuestionIndex=0,this.totalQuestions=this.questions.length,this.lastQuestionIndex=this.totalQuestions-1,this.totalAnswered=0,this.totalCorrects=0,this.tracker={},this.resultId=null,this.result=null,this.isSavedPlayer=!1,this.points={},this.loadCommonEvents(),this.loadEvents()}return _createClass(n,[{key:"isEmpty",value:function(e){return void 0===e||""===e||!1===e||0===e||""===e||{}===e||[]===e}},{key:"isShowPlayData",value:function(){return!this.isEmpty(this.quizData.playData)}},{key:"isShowNextButton",value:function(){return"off"!==this.settings.show_next_button}},{key:"showAnswered",value:function(){}},{key:"loadCommonEvents",value:function(){var t=this;this.$wrapper.on("click",".wq-embed-toggle-btn",function(e){return t.handleClickToggleEmbed(e)}),this.$wrapper.on("click",".wq-embed:not(.active)",function(e){if(e.currentTarget.querySelector("img")){var t=e.currentTarget.querySelector("iframe"),n=t.src;e.currentTarget.classList.add("active"),t&&(t.src=0<=n.indexOf("?")?n+"&autoplay=1":n+"?autoplay=1")}})}},{key:"loadEvents",value:function(){var t=this;this.$wrapper.on("click.answer",".wq-answer",function(e){return t.handleClickAnswer(e)}),this.$wrapper.on("click.nextQuestion",".wq-continue-btn",function(e){return t.handleClickNextQuestionButton(e)}),this.$wrapper.on("click.retakeQuiz",".wq-retake-quiz-btn",function(e){return t.handleClickRestartQuizButton(e)})}},{key:"handleClickAnswer",value:function(e){var t=r(e.currentTarget);if(!t.hasClass("chosen")){var n=t.closest(".wq-question");this.isAnswered(n)||(t.closest(".wq-answer").addClass("chosen"),this.isFullyAnswered(n)&&(n.addClass("wq_questionAnswered"),this.trackAnswer(n),this.totalAnswered++,this.currentQuestionIndex=parseInt(n.attr("data-index")),this.afterClickAnswer(t,n),this.nextQuestion()))}}},{key:"handleClickNextQuestionButton",value:function(e){e.preventDefault();var t=r(e.currentTarget).closest(".wq-question");this.goToNextQuestion(t)}},{key:"handleClickRestartQuizButton",value:function(e){e.preventDefault(),this.restartQuiz()}},{key:"handleClickToggleEmbed",value:function(e){e.preventDefault(),r(e.currentTarget).parent().toggleClass("active").next().slideToggle("fast")}},{key:"handleClickBeginQuiz",value:function(e){var t=this;e.preventDefault(),this.$wrapper.find(".wq-quiz-intro-container").fadeOut("fast",function(){t.$wrapper.find(".wq-progress-bar-container, .wq-questions, .wq-embed-toggle, .wq_promoteQuizCtr").fadeIn("fast")})}},{key:"goToNextQuestion",value:function(t){var n=this;if(this.isAnswered(t)){if(this.totalAnswered<this.totalQuestions?t.animateCss(this.settings.animation_out,function(){var e=t.next(".wq-question");t.offset().top;t.hide(),e.show().animateCss(n.settings.animation_in)}):this.$wrapper.find(".wq-results").is(":visible")||this.complete(),t.find(".wq-embed iframe").length){var e=t.find(".wq-embed iframe"),i=e.attr("src");e.attr("src",""),e.attr("src",i.replace("&autoplay=1",""))}t.find(".wq-question-video video").length&&t.find(".wq-question-video video")[0].player&&t.find(".wq-question-video video")[0].player.pause()}}},{key:"isFullyAnswered",value:function(e){return!0}},{key:"afterClickAnswer",value:function(e,t){if("multiple"===this.settings.question_layout)if(this.$wrapper.find(".wq_quizProgressBar").length&&this.updateProgressBar(),this.isShowNextButton()){var n=t.find(".wq_continue");this.totalAnswered<this.totalQuestions&&t.find(".wq_continue").length&&n.show()}else this.goToNextQuestion(t)}},{key:"updateProgressBar",value:function(e){void 0===e&&(e=parseInt(100*this.totalAnswered/this.totalQuestions)),this.$wrapper.find(".wq_quizProgressValue").animate({width:e+"%"}).text(e+"%")}},{key:"nextQuestion",value:function(){return this.totalAnswered===this.totalQuestions?this.complete():this.currentQuestionIndex===this.lastQuestionIndex?(this.currentQuestionIndex=-1,this.nextQuestion()):(this.currentQuestionIndex++,this.isAnswered(this.currentQuestionIndex)?this.nextQuestion():void("single"===this.settings.question_layout&&"on"===this.settings.auto_scroll&&this.scrollToQuestion(this.currentQuestionIndex)))}},{key:"complete",value:function(){var e=this;if(!this.isAnswerOnly){this.$wrapper.addClass("is-completed"),this.findResultId(),this.isSavedPlayer||(this.savePlayData(),this.isSavedPlayer=!0);var t=this.$wrapper.find(".wq-force-action-container"),n=this.$wrapper.find('.wq-question[data-index="'+this.lastQuestionIndex+'"]');t.length?"multiple"===this.settings.question_layout?n.animateCss(this.settings.animation_out,function(){n.hide();n.offset().top;n.hide(),t.show().animateCss(e.settings.animation_in)}):t.show():(this.results.length&&this.showResult(),this.$wrapper.find(".wq-retake-quiz").length&&this.$wrapper.find(".wq-retake-quiz").show()),"single"===this.settings.question_layout&&("on"===this.settings.end_answers?this.scrollToQuestion(0):this.results.length&&this.scrollToResults()),this.$wrapper.trigger("wp_quiz_complete_quiz",[this])}}},{key:"findResultId",value:function(){}},{key:"trackAnswer",value:function(e){}},{key:"savePlayData",value:function(){}},{key:"showResult",value:function(){}},{key:"scrollToResults",value:function(){var e=this.$wrapper.find(".wq-force-action-container").length?this.$wrapper.find(".wq-force-action-container"):this.$wrapper.find(".wq-results");r("html, body").animate({scrollTop:e.offset().top-95})}},{key:"scrollToQuestion",value:function(e){r("html, body").animate({scrollTop:this.$wrapper.find('.wq-question[data-index="'+e+'"]').offset().top-95})}},{key:"restartQuiz",value:function(){this.currentQuestionIndex=0,this.totalAnswered=0,this.totalCorrects=0,this.tracker={},this.isSavedPlayer=!1,"multiple"===this.settings.question_layout&&(this.$wrapper.find(".wq-question").hide(),this.$wrapper.find('.wq-question[data-index="0"]').show()),this.scrollToQuestion(0),this.updateProgressBar(),this.$wrapper.removeClass("is-completed"),this.$wrapper.removeClass("show-played"),this.$wrapper.find(".wq_questionAnswered").removeClass("wq_questionAnswered"),this.$wrapper.find(".is-correct").removeClass("is-correct"),this.$wrapper.find(".is-incorrect").removeClass("is-incorrect"),this.$wrapper.find(".chosen").removeClass("chosen"),this.$wrapper.find(".wq-question:not(.wq-is-ad) .wq_continue, .wq-results, .wq-result, .wq-retake-quiz").hide(),this.$wrapper.find(".wq-question").removeClass("force-show")}},{key:"isAnswered",value:function(e){return"function"==typeof e.hasClass?e.hasClass("wq_questionAnswered")||e.hasClass("wq-is-ad"):this.$wrapper.find('.wq-question[data-index="'+e+'"]').hasClass("wq_questionAnswered")}}]),n}(),r(document).ready(function(){r(document).on("click",".wq-share-fb",function(e){if("undefined"!=typeof FB){e.preventDefault();var t=e.currentTarget.dataset.url;if(e.currentTarget.dataset.trackingId){var n=e.currentTarget.dataset.trackingId;t=-1===t.indexOf("?")?t+"?wqtid="+n:t+"&wqtid="+n}else if(e.currentTarget.dataset.imageFile){var i=e.currentTarget.dataset.imageFile;t=-1===t.indexOf("?")?t+"?wqimg="+i:t+"&wqimg="+i}FB.ui({method:"share",href:t},function(e){console.log(e)})}}),r(document).on("click",".wq-share-tw",function(e){e.preventDefault();var t=e.currentTarget.dataset.url;if(e.currentTarget.dataset.trackingId){var n=e.currentTarget.dataset.trackingId;t=-1===t.indexOf("?")?t+"?wqtid="+n:t+"&wqtid="+n}else if(e.currentTarget.dataset.imageFile){var i=e.currentTarget.dataset.imageFile;t=-1===t.indexOf("?")?t+"?wqimg="+i:t+"&wqimg="+i}t="https://twitter.com/intent/tweet?url="+encodeURIComponent(t);var s=r(e.currentTarget).closest(".wq-quiz").find(".wq-result:visible .wq-result-score"),a=r(e.currentTarget).closest(".wq-quiz").find(".wq-result:visible .wq-result-title");s.length&&s.text()?t+="&text="+encodeURIComponent(s.text()):a.length&&a.text()&&(t+="&text="+encodeURIComponent(a.text())),window.open(t,"_blank","width=500, height=300")}),r(document).on("click",".wq-share-gp",function(e){e.preventDefault();var t=e.currentTarget.dataset.url;if(e.currentTarget.dataset.trackingId){var n=e.currentTarget.dataset.trackingId;t=-1===t.indexOf("?")?t+"?wqtid="+n:t+"&wqtid="+n}else if(e.currentTarget.dataset.imageFile){var i=e.currentTarget.dataset.imageFile;t=-1===t.indexOf("?")?t+"?wqimg="+i:t+"&wqimg="+i}window.open("https://plus.google.com/share?url="+encodeURIComponent(t),"_blank","width=500, height=300")}),r(document).on("click",".wq-share-vk",function(e){e.preventDefault();var t=e.currentTarget.dataset.url;if(e.currentTarget.dataset.trackingId){var n=e.currentTarget.dataset.trackingId;t=-1===t.indexOf("?")?t+"?wqtid="+n:t+"&wqtid="+n}else if(e.currentTarget.dataset.imageFile){var i=e.currentTarget.dataset.imageFile;t=-1===t.indexOf("?")?t+"?wqimg="+i:t+"&wqimg="+i}window.open("http://vk.com/share.php?url="+encodeURIComponent(t),"_blank","width=500, height=300")}),r(document).on("click",".wq-question-hint-button",function(e){return e.stopPropagation(),e.preventDefault(),r(this).prev(".wq-question-hint-content").slideToggle(),!1}),r(document).on("click",".wq-question-hint-content",function(e){return e.stopPropagation()}),r(document).on("click",function(e){return r(".wq-question-hint-content").hide()})})}(wpQuiz,jQuery);